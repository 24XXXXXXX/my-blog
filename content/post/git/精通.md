---
title: "Git 精通：回到任意提交与安全撤销"
description: "掌握 checkout/switch/restore、reset 三种模式、revert 与 reflog，用正确方式回到过去并安全撤销。"
keywords: "git,git checkout,git switch,git restore,git reset,git revert,git reflog,回滚"

date: 2025-12-19T11:10:22+08:00
lastmod: 2025-12-19T11:10:22+08:00

math: false
mermaid: false

categories:
  - Git
tags:
  - Git
  - 回滚
  - reset
  - revert
---
这篇是 Git「精通」部分：你不仅能“回到过去”，还要知道 **用哪种方式回到过去最安全**。

目标：在不把团队仓库搞乱的前提下，熟练使用 `checkout/switch/restore`、`reset`、`revert`，并用 `reflog` 兜底。
<!--more-->

# 1.先统一语言：你到底想“回到过去”的哪一种？

常见需求其实有三类：

1. **只是看看旧代码**（不打算改历史）。
2. **把当前分支指针移回去**（改写历史，通常只建议在本地分支）。
3. **在不改写历史的前提下撤销某次提交**（团队协作/已推送场景优先）。

下面分别对应：

- 查看：`git switch --detach` / `git checkout <commit>`
- 重置：`git reset --soft/--mixed/--hard`
- 回退：`git revert`

# 2.找到“那一次提交”

先定位目标提交：

```bash
git log --oneline --decorate --graph
```

如果只关心某个文件相关的历史：

```bash
git log --oneline -- path/to/file
```

# 3.只查看旧版本：checkout / switch（分离 HEAD）

临时切到某个提交（进入“分离 HEAD”状态）：

```bash
git checkout <commit>
```

或（更现代的写法）：

```bash
git switch --detach <commit>
```

用途：

- 临时查看旧版本代码
- 编译/跑测试验证某个历史状态

注意：

- 分离 HEAD 状态下做的提交，不会自动挂在任何分支上，容易“丢”。
- 如果你要在旧版本上继续开发，建议创建新分支：

```bash
git switch -c hotfix-from-old <commit>
```

回到当前主分支：

```bash
git switch main
```

# 4.撤销“工作区/暂存区”的改动：restore

这类撤销不涉及提交历史，属于“本地撤销”。

## 4.1 丢弃工作区改动（回到暂存区/HEAD）

```bash
git restore path/to/file
```

## 4.2 取消暂存（把暂存区退回工作区）

```bash
git restore --staged path/to/file
```

## 4.3 从指定提交恢复文件内容

```bash
git restore --source <commit> path/to/file
```

# 5.改写历史：reset（慎用，主要用于本地分支）

`reset` 的本质：移动分支指针（比如 `main` 指向的提交），并可选地重置暂存区/工作区。

## 5.1 三种模式

### soft：只移动指针（保留暂存区和工作区）

```bash
git reset --soft <commit>
```

适用：想把多个提交“合并重提”，但不想丢改动。

### mixed（默认）：移动指针 + 清空暂存区（保留工作区）

```bash
git reset --mixed <commit>
```

适用：想重新选择哪些改动要暂存/提交。

### hard：移动指针 + 重置暂存区 + 重置工作区（最危险）

```bash
git reset --hard <commit>
```

警告：会直接丢弃该提交之后的本地改动。

## 5.2 什么时候不要用 reset？

如果这些提交已经 `git push` 到远程，并且别人可能基于它继续工作：

- **不要对共享分支做 reset 并强推**（除非团队明确约定且你完全知道后果）。

# 6.安全撤销：revert（推荐用于已推送/共享分支）

`revert` 会创建一个新提交，用“反向操作”撤销某个提交的改动。

```bash
git revert <commit>
```

优点：

- 不改写历史
- 适合团队协作
- 历史清晰可追溯

如果要连续回退多个提交：

```bash
git revert <old>..<new>
```

# 7.最后的后悔药：reflog

即使你做了 `reset --hard`，很多时候仍然能救回来，因为 Git 会记录 HEAD 的移动历史：

```bash
git reflog
```

你会看到每次指针移动的记录（含旧的 commit）。

恢复到 reflog 里某个位置：

```bash
git reset --hard <reflog-commit>
```

# 8.快速决策：我该用哪个命令？

- **只是想看旧代码**：`git switch --detach <commit>`
- **想撤销未提交改动**：`git restore`
- **想取消暂存**：`git restore --staged`
- **本地提交想重写/合并**：`git reset --soft` / `--mixed`
- **公共分支撤销某次提交**：`git revert`
- **手滑 reset 了**：`git reflog` 先找回路
